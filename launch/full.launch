<!--This file launches either a bag or a simulation and the point-cloud converter.--> 
<!--  Newtorks can be launched through the desiccation_cnn package -->
<!--  -->
<launch>
  <!-- <arg name="debug" default="true"/> -->
  <arg name="simulation" default="false"/>
  <arg name="control" default="false"/>
  <arg name="world" default="serf"/>
  <arg name="camera_name" default="/scouter_vision"/>
  <arg name="out_width" default="1920"/> <!-- 256 --> 
  <arg name="out_height" default="1080"/> <!-- 192 -->
  <arg name="static_tf" default="False"/>
  <arg name="rviz" default="True"/>
  <arg name="pcl_topic" default="pcl_plane"/>
  <arg name="world_frame" default="map"/>
  <arg name="camera_frame" default="oak_d_link"/>
  <arg name="info_topic" default="$(arg camera_name)/camera_info"/>
  <arg name="image_topic" default="$(arg camera_name)/image_raw"/>

  <!-- Simulation or rosbag -->
  <!-- Rosbag -->
  <node unless="$(arg simulation)" pkg="rosbag" type="play" name="player" output="screen" args="--clock $(find quadmap)/rosbag/2021-08-25_15-23-09_serf_mode-3.bag tf_throttle:=tf"/>
  
  <!-- Simulation -->
  <include if="$(arg simulation)" file="$(find desiccation_cnn)/launch/simulation.launch">
      <arg name="world" value="$(arg world)"/>
  </include>
  <!-- Control -->
  <include if="$(arg control)" file="$(find uas_offboard_planner)/launch/hardware_control.launch"/>

  <!-- The pcl file - uses cascaded calibration file -->
  <include file="$(find learning_image_geometry)/launch/pcl.launch">
    <arg name="camera_name" value="$(arg camera_name)"/>
    <arg name="out_width" value="$(arg out_width)"/>
    <arg name="out_height" value="$(arg out_height)"/>
    <arg name="static_tf" value="$(arg static_tf)"/>
    <arg name="camera_frame" value="$(arg camera_frame)"/>
    <arg name="pcl_topic" value="$(arg pcl_topic)"/>
    <arg name="world_frame" value="$(arg world_frame)"/>
    <arg name="camera_info_topic" value="$(arg camera_info_topic)"/>
    <arg name="image_topic" value="$(arg image_topic)"/>
  </include>
  
  <!-- RVIZ -->
  <node if="$(arg rviz)" pkg="rviz" type="rviz" output="screen" name="rviz" respawn="true" args="-d $(find quadmap)/config/rviz_pcl.rviz"/>
</launch>
